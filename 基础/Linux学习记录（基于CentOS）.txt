										Linux学习记录（基于CentOS）
	Linux是一个操作系统内核，RHEL、CentOS、Ubuntu等发行版是将linux内核和各种GNU工具打包在一起后发布的完整操作系统。几种
常见linux发行版：早期 Red Hat --> Fedora		Debian -->		Slackware -->
						|						   |				|
					  RHEL --> 					  Ubuntu -->		SUSE -->
						|
					  CentOS --> 
	CentOS安装:基于Vmware Workstation
	新建虚拟机：vmware中选择创建新的虚拟机，然后选择“稍后安装操作系统”，继续直到选择安装位置，选择一个有足够空间的盘符下的文件夹，
输入虚拟机名，下一步设置分配的磁盘容量，使用默认20G就够了，下一步后点击“自定义硬件”，其中“CD/DVD”项不修改，网络设备
选择NAT，然后关闭就结束了。
	几种网络模式说明：桥接模式——虚拟机和物理机以并列方式连接同一个网络，NAT模式——物理机作为虚拟机的“路由器”，
仅主机模式——相当于使用网线直接连接虚拟机和物理机。
	安装linux：在新建的虚拟机主页，点击“编辑虚拟机设置”，“CD/DVD”项选择“使用ISO镜像文件”，选择下载的centos镜像。然后确定。
虚拟机主页点击“开启此虚拟机”，进入安装过程，选择第一行“Install ...”，回车后设置语言等，继续到安装信息摘要，点击“安装位置”，
选中“我要配置分区”，点击“完成”，进入分区界面，LVM下拉框选择“标准分区”，点击 + 号设置挂载点为 /boot，期望容量为 200M，然后
添加挂载点。继续添加 swap 分区，4GB，根分区 /，期望容量留空，表示将剩下的空间全部给根挂载点。点击完成-->接受更改-->开始安装，
点击“ROOT密码”设置root密码，然后继续直到安装完成，点击重启。输入root、root密码后登陆系统。
	使用 dhclient 自动获取一个ip地址，使用 ip addr查看ip地址。使用 ping -c 4 www.baidu.com 测试网络联通性。
	使用 vi /etc/sysconfig/network-scripts/ifcfg-ens33 设置静态ip：ONBOOT=no 改为yes（网卡驱动随着系统一起启动），
BOOTPROTO=dhcp 改为static（静态ip），新增：
		IPADDR=192.168.112.88
		NETMASK=255.255.255.0
		GATEWAY=192.168.112.2
		DNS1=119.29.29.29
	使用 systemctl restart network.service 重启网络服务。
	使用图形用户界面登陆，默认在tty1，但是tty命令显示是0，可以使用Ctrl+Alt+(F2~F6)不关闭图形服务切换到命令行，使用
Ctrl+Alt+F1切换回图形用户界面。
	图形用户界面使用 init 3 关闭图形服务并切换到命令行界面。
	使用 startx 开启图形服务。（最好不使用）
	快捷键：Ctrl+D 退出当前终端 Ctrl+C 结束当前命令 Ctrl+Z暂停当前进程，使用fg恢复 Ctrl+A移动光标到行首，Ctrl+E移动
光标到行尾。
	关机：shutdown -h now/10   -r（重启） 关机前使用sync将内存中数据写到磁盘。
	忘记root用户密码处理方法：
	1重启系统，加载内核前使用下键停止继续启动，然后移动到第一行输入e进入编辑界面，找到linux16开头的行，修改ro为
rw init=/sysroot/bin/bash，然后Ctrl+x进入emergency模式，使用chroot切换到sysroot（原始系统）[chroot /sysroot/]，使用LANG=en改变当前终端
语言为英语，然后使用passwd输入新密码,touch /.autorelabel 使修改生效，然后使用Ctrl+D，reboot重启系统。
	2使用rescue模式：虚拟机中电源处选择“打开电源进入固件”，进入BIOS后设置启动系统从光驱开始（将CD-ROM移到最前），F10
保存退出后进入光驱启动模式，使用下键选择Troubleshooting，回车后选择Rescue a CentOS...连续回车到输出提示，输入1继续，
然后chroot /mnt/sysimage进入初试系统，使用passwd改密码。Ctrl+D退出Rescue模式，reboot重启。

	远程登录
	linux系统通过sshd服务提供远程登录功能，默认使用22号端口，通常安装完系统就默认安装并开启了该服务，所以不需要进行额外
的配置。sshd服务的配置文件是：/etc/ssh/sshd_config
	修改主机名：hostname asuser 永久修改：vi /etc/hostname
	centos默认使用openssh-clients作为远程登录客户端，使用ssh -V查看软件版本，安装该工具：yum install -y openssh-clients
	使用init 0 也可以关机
	openssh-clients登陆远程主机：ssh root@192.168.1.103
	
	基础命令
	ls -ld /tmp		-d通常和-l一起使用，写出-ld。-d用于查看参数目录的信息而不是参数目录的下级内容的信息
	cd 不加参数会直接进入用户主目录
	mkdir -p /tmp/test/01	-p用于逐级创建目录，如果目录已存在也不会报错，也不会做其他事情
	rmdir /tmp/test 只能删除空目录 -p可以从里到外逐级删除空目录
	rm -r用于删除目录，-f用于取消提示 删除目录通常使用rm -rf /tmp/test 不用用/做参数，非常危险
	which rmdir 用于查找某个命令的绝对路径
	查看PATH环境变量：echo $PATH	输出：/usr/bin:/root/bin:...
	将/root加入PATH变量：PATH=$PATH:/root
	mv /tmp/test/test.txt /root/ 移动文件或目录
	cp aaa bbb 复制文件 -r用于复制目录 CentOS中cp实际是cp -i
	echo 'abc' > aaa 将'aaa'重定向写入aaa文件
	cat test.txt -n 显示文件内容和行号
	cat -A test.txt 显示所有内容，包括不可特殊字符（-A 会将中文作为特殊字符处理，即不能正确识别中文）
	tac test.txt 倒序显示文件内容
	more和less用于分页查看文件，使用ctrl+D(B)回翻到上一页，空格键到下一页，less中使用j和k进入下一行和上一行，可以使用
/和?进行搜索，n跳转到下一个匹配项，/用于向下搜索，?用于向上搜索。
	head test.txt 默认显示前10行，-n 20 显示前20行，也可以写 head -20 test.txt
	tail用于查看文件末尾10行，-n 20显示最后20行，-f 动态查看最后10行
	ls -l 输出的第一列第一位表示文件的类型：
		d	目录	
		-	普通文件
		l	链接文件
		b 	块设备文件
		c	串行端口设备文件
		s	套接字文件
	ls -l 输出的第三列是节点数
	groupadd testgroup 新增用户组
	chgrp testgroup test.txt 修改文件所属组
	chgrp -R testgroup /tmp 修改目录和子目录所属组
	chown testuser[:testgroup] test.txt 修改文件所有者和所属组 -R用于同时修改目录和子目录
	读写执行的数字表示：r--4, w--2, x--1, -:0
	目录的默认权限是755(rwxr-xr-x)，文件的默认权限是644(rw-r--r--)
	chmod 750 dir1 改变目录权限 -R用于目录权限的级联修改，还可以这样使用：
		chmod u=rwx,go=rx dir2
		chmod u-x,g+w dir3
	umask 返回设置的umask值，文件的默认权限是根据umask值来设置的：普通文件权限使用666按位减去umask值，目录权限使用
777减去umask值，比如root用户默认umask值为022，普通用户为002，所以root创建的普通文件权限是644，而目录式755
	使用umask 002修改umask
	chattr +i dir4	添加i属性后，文件不能删除、重命名、设定链接、写入和新增数据
	chattr +a dir5  添加a属性后，文件只能追加不能删除，只有root才能设置这个属性
	lsattr -aR dir6 列出目录下所有文件和递归子目录的特殊属性
	set uid	 二进制可执行文件上的一种附加权限，可以让文件在执行时具有文件所有者的权限，比如passwd文件具有这个权限，
所以普通用户可以执行passwd来修改自己的秘密。
	set gid 和 set uid 一样，用于让文件在执行时具有文件所属组的权限
	sticky bit 相当于防删除位，目录设置此权限后，对这个目录有写权限的用户不能删除其它用户的文件。
		passwd的权限：rwsr-xr-x 如果没有x权限，则使用大写的S 
		/tmp/的权限： rwxrwxrwt 
	which vi 查找命令文件
	where [-b/-s/-m] file 查找[二进制/源码/帮助]文件 在索引库中执行模糊查找
	locate 类似于where，可以使用updatedb更新索引库，但是这个命令可能会需要一段时间
	find /path [options]
		find /path -mtime[-atime/-ctime] -10 10天以内进行过 “写入数据/访问文件/修改文件内容、属性”的文件 
			stat file 查询文件的mtime、ctime、atime
		find /path -name fileName 或 find /path -name "test*"
		find /path -type d 按类型查询
	查看支持的文件系统：cat /etc/filesystems
	centos7默认使用xfs文件系统，centos6使用的文件系统是ext4
	现代linux支持最多可使用255个字符作为文件名
	软链接和硬链接：
		ln -s orifile soft-link 
		ln orifile hard-link
		软链接相当于windows的快捷方式，删除原文件后就不能打开了。
		硬链接是复制了一个新的原文件的inode节点，这样删除原文件就不会实际删除文件，而只是删除了原文件名指向的
		inode节点，这时使用硬链接仍然可以访问原文件。
	
	用户管理
	查看/etc/passwd文件：cat /etc/passwd | head
	返回：root:x:0:0:root:/root:/bin/bash
	/etc/passwd文件中每一行被:分隔为7个字段：第一个是用户名，可以是大小写字母、数字(不能再首位)、减号、点号和下划线
第二个字段是密码，现在不真正保存在这里，所以使用x占位，第三个字段是uid，root是0，自建的用户通常从1000开始；第四个字段
是gid，第五个字段是用户信息说明，第六个字段是用户的家目录；第七个字段是用户的shell，如果是/sbin/nologin表示这个用户
不能登陆。
	查看/etc/shadow文件：cat /etc/shadow | head -n 3
	返回：root:$6$xEeBczsD$U486aOPTUqBNei7PmpQVm9RqKIvy6XN3Rfr4F52sm1XP1WE6.T5HFdlmsLfyv6ltGZwvapet0rPlHzlF2
uvhV.:17883:0:99999:7:::
	/etc/shadow文件每条记录被:分隔为9个字段：第一个是用户名，第二个是加密后的密码，第三个是上一次修改密码的日期(距离
1970年1月1日的天数，考虑闰年)，第四个字段表示要过多少天才能修改密码，默认为0，第五个是密码多少天后到期，第六个是密码
到期前发出警告的天数，第七个是失效日期，即到期未修改密码过后多少天锁定账号，第八个字段是账号有效日期，即从1970年开始
有效的天数，过了时间账号就被锁定，第九个是保留使用，没有意义
	为了安全，/etc/shadow文件权限通常被设置为000，只有root能修改查看
	新增用户组：groupadd [-g gid] groupName 查看：tail -n3 /etc/group
	删除用户组：groupdel groupName 不能删除具有用户的用户组，必须先删除用户
	新增用户：useradd [-u uid] [-g gid] [-d homeDir] [-M] [-s shellDir] userName
	-d表示自定义家目录，-M表示不创建家目录(/etc/passwd文件中会有家目录名，但是这个目录实际没有创建)，-s表示自定义shell
	删除用户：userdel userName
	更改/etc/passwd记录的第五个字段-用户说明：chfn shanyu
	根据关键词过滤查询：grep 'shanyu' /etc/passwd
	更改密码：更改自己的秘密直接使用passwd
	root用户可以使用 passwd userName修改指定用户的秘密
	使用mkpasswd生成密码：先安装expect ： yum install -y expect 然后直接使用mkpasswd生成9位随机密码
指定长度： mkpasswd -l 12
	切换用户：su [-] userName [-]表示初始化用户环境变量，root切换普通用户不需要密码，使用exit返回原用户
	普通用户使用su切换到root是需要root密码的，但是这不太安全，所以出现了sudo
	sudo配置文件：/etc/sudoers
	默认只有root能使用sudo，使用visudo 编辑/etc/sudoers文件（先安装 yum install -y sudo）:
shanyu  ALL=(ALL)  ALL 允许shanyu用于在所有主机上以所有用户身份使用sudo执行所有命令
	使用sudo：sudo cat /etc/shadow 使用sudo需要输入自己的秘密
	为用户组shanyu配置sudo：%shanyu  ALL=(ALL)  ALL
	/etc/sudoers中配置用户别名：User_Alias USER_AUTH = shanyu,zhangwei
	/etc/sudoers中配置命令别名：Cmnd_Alias SU = /usr/bin/su
	/etc/sudoers中配置不需要密码切换用户：USER_AUTH ALL=(ALL) NOPASSWD:SU
	这样shanyu用户就可以使用 sudo su - root 直接切换到root，而不用输入密码
	sshd配置文件：/etc/ssh/sshd_config,不允许root远程登录：PermitRootLogin no, 重启sshd服务：systemctl restart sshd.system
	
	